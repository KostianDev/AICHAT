<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="aichat.ui.MainController"
            prefWidth="1400" prefHeight="900"
            minWidth="800" minHeight="600"
            stylesheets="@dark-theme.css">
    
    <top>
        <VBox styleClass="top-container">
            <MenuBar styleClass="menu-bar">
                <menus>
                    <Menu text="File">
                        <items>
                            <MenuItem text="Load Source Image" onAction="#handleLoadSource"/>
                            <MenuItem text="Load Target Image" onAction="#handleLoadTarget"/>
                            <SeparatorMenuItem/>
                            <MenuItem text="Exit" onAction="#handleExit"/>
                        </items>
                    </Menu>
                    <Menu text="Help">
                        <items>
                            <MenuItem text="About" onAction="#handleAbout"/>
                        </items>
                    </Menu>
                </menus>
            </MenuBar>
            
            <ToolBar styleClass="tool-bar">
                <padding><Insets top="12" bottom="12" left="16" right="16"/></padding>
                <Button fx:id="loadSourceButton" text="Load Source" onAction="#handleLoadSource" styleClass="toolbar-button"/>
                <Button fx:id="loadTargetButton" text="Load Target" onAction="#handleLoadTarget" styleClass="toolbar-button"/>
                <Separator orientation="VERTICAL"/>
                
                <Label text="Algorithm:" styleClass="toolbar-label"/>
                <ComboBox fx:id="algorithmCombo" prefWidth="150" styleClass="toolbar-combo"/>
                
                <Label text="Color Model:" styleClass="toolbar-label"/>
                <ComboBox fx:id="colorModelCombo" prefWidth="150" styleClass="toolbar-combo"/>
                
                <Label text="Colors (k):" styleClass="toolbar-label"/>
                <Spinner fx:id="kSpinner" prefWidth="100" styleClass="toolbar-spinner"/>
                
                <Separator orientation="VERTICAL"/>
                <Button fx:id="analyzeButton" text="Analyze" onAction="#handleAnalyze" styleClass="toolbar-button,action-button"/>
                <Button fx:id="resynthesizeButton" text="Resynthesize" onAction="#handleResynthesize" styleClass="toolbar-button,action-button-primary"/>
            </ToolBar>
        </VBox>
    </top>
    
    <center>
        <SplitPane fx:id="mainSplitPane" dividerPositions="0.5" orientation="HORIZONTAL" styleClass="main-split-pane">
            <VBox spacing="12" styleClass="image-panel">
                <padding><Insets top="16" bottom="16" left="16" right="16"/></padding>
                <HBox spacing="12" alignment="CENTER_LEFT">
                    <Label text="Source Image" styleClass="panel-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="Load" onAction="#handleLoadSource" styleClass="small-button"/>
                </HBox>
                <ScrollPane fx:id="sourceScrollPane" VBox.vgrow="ALWAYS" styleClass="image-scroll" pannable="true">
                    <StackPane fx:id="sourceImageContainer" styleClass="image-container">
                        <ImageView fx:id="sourceImageView" preserveRatio="true"/>
                    </StackPane>
                </ScrollPane>
                <TitledPane text="Source Palette" expanded="true" collapsible="true" styleClass="palette-pane" maxHeight="160" minHeight="160">
                    <ScrollPane fitToWidth="true" styleClass="palette-scroll">
                        <FlowPane fx:id="sourcePalettePane" hgap="8" vgap="8" prefWrapLength="400" alignment="CENTER_LEFT">
                            <padding><Insets top="10" bottom="10" left="10" right="10"/></padding>
                        </FlowPane>
                    </ScrollPane>
                </TitledPane>
            </VBox>
            
            <VBox spacing="12" styleClass="image-panel">
                <padding><Insets top="16" bottom="16" left="16" right="16"/></padding>
                <HBox spacing="12" alignment="CENTER_LEFT">
                    <Label text="Target Image" styleClass="panel-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="Load" onAction="#handleLoadTarget" styleClass="small-button"/>
                </HBox>
                <ScrollPane fx:id="targetScrollPane" VBox.vgrow="ALWAYS" styleClass="image-scroll" pannable="true">
                    <StackPane fx:id="targetImageContainer" styleClass="image-container">
                        <ImageView fx:id="targetImageView" preserveRatio="true"/>
                    </StackPane>
                </ScrollPane>
                <TitledPane text="Target Palette" expanded="true" collapsible="true" styleClass="palette-pane" maxHeight="160" minHeight="160">
                    <ScrollPane fitToWidth="true" styleClass="palette-scroll">
                        <FlowPane fx:id="targetPalettePane" hgap="8" vgap="8" prefWrapLength="400" alignment="CENTER_LEFT">
                            <padding><Insets top="10" bottom="10" left="10" right="10"/></padding>
                        </FlowPane>
                    </ScrollPane>
                </TitledPane>
            </VBox>
        </SplitPane>
    </center>
    
    <bottom>
        <HBox spacing="16" styleClass="status-bar" alignment="CENTER_LEFT">
            <padding><Insets top="12" bottom="12" left="20" right="20"/></padding>
            <ProgressBar fx:id="progressBar" prefWidth="300" prefHeight="24"/>
            <Label fx:id="statusLabel" text="Ready" styleClass="status-label"/>
        </HBox>
    </bottom>
</BorderPane>
